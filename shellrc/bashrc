# $HOME/.bashrc
#
# this file is sourced by all *interactive* bash shells on startup,
# including some apparently interactive shells such as scp and rcp
# that can't tolerate any output. so make sure this doesn't display
# anything or bad things will happen !

# source all files matching pattern in a directory
# NOTE: defined early so .bash_profile can use it in non-interactive shells
source_dir() {
  local dir="$1" ext="$2"
  local files=("$dir"/*."$ext")
  [[ -e "${files[0]}" ]] && for f in "${files[@]}"; do source "$f"; done
}

# test for an interactive shell. there is no need to set anything
# past this point for scp and rcp, and it's important to refrain from
# outputting anything in those cases.
if [[ $- != *i* ]] ; then
  # shell is non-interactive. be done now!
  return
fi

shopt -s nullglob

# PATH setup
source_dir "$HOME/.shellrc/paths.d" sh
[[ "$(uname)" == "Darwin" ]] && source_dir "$HOME/.shellrc/paths.d.osx" sh

# clean up any path dupes
if [[ -z $TMUX ]]; then
  PATH=$(echo "$PATH" | tr ':' '\n' | awk '!seen[$0]++' | tr '\n' ':' | sed 's/:$//')
fi

# common config
source_dir "$HOME/.shellrc/rc.d" sh
[[ "$(uname)" == "Darwin" ]] && source_dir "$HOME/.shellrc/rc.d.osx" sh

# bash-specific overrides
source_dir "$HOME/.shellrc/bashrc.d" bash
[[ "$(uname)" == "Darwin" ]] && source_dir "$HOME/.shellrc/bashrc.d.osx" bash
